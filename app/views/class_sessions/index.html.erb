<div class="animate-fade-in">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 fw-bold">Clases</h1>
      <p class="text-muted mb-0">Gestiona las clases de tu curso</p>
    </div>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#classModal" onclick="openCreateModal()">
      <i class="bi bi-plus-lg me-2"></i>Nueva Clase
    </button>
  </div>

  <!-- Sessions List -->
  <div class="card bg-card border-secondary">
    <div class="card-header bg-transparent border-secondary">
      <h5 class="card-title mb-0">
        <i class="bi bi-book-fill text-primary me-2"></i>
        Lista de Clases (<%= @class_sessions.count %>)
      </h5>
    </div>
    <div class="card-body">
      <% if @class_sessions.any? %>
        <div class="table-responsive">
          <table class="table table-dark table-hover align-middle mb-0">
            <thead>
            <tr class="text-muted small text-uppercase">
              <th>Fecha</th>
              <th>Tema</th>
<!--              <th>Descripción</th>-->
              <th class="text-end">Acciones</th>
            </tr>
            </thead>
            <tbody>
            <% @class_sessions.each do |session| %>
              <tr>
                <td class="fw-medium">
                  <i class="bi bi-calendar3 me-2 text-muted"></i>
                  <%= l(session.date, format: :short) %>
                </td>
                <td><%= session.topic %></td>
<!--                <td class="text-muted"><%#= session.description&.truncate(50) || '-' %></td>-->
                <td class="text-end">
                  <div class="d-flex gap-2 justify-content-end">
                    <%#= link_to class_session_path(session), class: "btn btn-sm btn-ghost" do %>
<!--                      <i class="bi bi-eye"></i>-->
                    <%# end %>
                    <button class="btn btn-sm btn-ghost" onclick="openEditModal('<%= session.id %>', '<%= j(session.topic) %>', '<%= session.date %>', '<%#= j(session.description || '') %>')">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button class="btn btn-sm btn-ghost text-danger" onclick="openDeleteModal('<%= session.id %>', '<%= j(session.topic) %>')">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="text-center py-5 text-muted">
          <i class="bi bi-book fs-1 d-block mb-3 opacity-50"></i>
          <p class="mb-1">No hay clases registradas</p>
          <small>Comienza creando tu primera clase</small>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Create/Edit Modal -->
<div class="modal fade" id="classModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-card border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title" id="classModalTitle">Nueva Clase</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <%= form_with url: class_sessions_path, method: :post, id: "classForm", local: true do |f| %>
        <div class="modal-body">
          <input type="hidden" name="_method" id="formMethod" value="post">

          <div class="mb-3">
            <label for="classTopic" class="form-label">Tema <span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="classTopic" name="class_session[topic]" placeholder="Ej: Introducción a Ruby on Rails" required>
          </div>

          <div class="mb-3">
            <label for="classDate" class="form-label">Fecha <span class="text-danger">*</span></label>
            <input type="date" class="form-control" id="classDate" name="class_session[date]" required>
          </div>

          <div class="mb-3">
            <label for="classDescription" class="form-label">Descripción (opcional)</label>
            <textarea class="form-control" id="classDescription" name="class_session[description]" rows="3" placeholder="Descripción de la clase..."></textarea>
          </div>
        </div>
        <div class="modal-footer border-secondary">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary" id="classSubmitBtn">Crear</button>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-card border-secondary">
      <div class="modal-header border-secondary">
        <h5 class="modal-title">¿Eliminar clase?</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted mb-0">
          Esta acción eliminará la clase "<span id="deleteClassName"></span>" y todos sus registros de asistencia. Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer border-secondary">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <form action="" method="post" id="deleteSessionForm">
          <input type="hidden" name="_method" value="delete">
          <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
          <button type="submit" class="btn btn-danger">Eliminar</button>
        </form>

      </div>
    </div>
  </div>
</div>

<script>
    // Obtener fecha de hoy en formato YYYY-MM-DD
    function getTodayDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Abrir modal para crear nueva clase
    function openCreateModal() {
        document.getElementById('classModalTitle').textContent = 'Nueva Clase';
        document.getElementById('classForm').action = '<%= class_sessions_path %>';
        document.getElementById('formMethod').value = 'post';
        document.getElementById('classTopic').value = '';
        document.getElementById('classDate').value = getTodayDate();
        document.getElementById('classDescription').value = '';
        document.getElementById('classSubmitBtn').textContent = 'Crear';
    }

    // Abrir modal para editar clase existente
    function openEditModal(id, topic, date, description) {
        document.getElementById('classModalTitle').textContent = 'Editar Clase';
        document.getElementById('classForm').action = '/class_sessions/' + id;
        document.getElementById('formMethod').value = 'patch';
        document.getElementById('classTopic').value = topic;
        document.getElementById('classDate').value = date;
        document.getElementById('classDescription').value = description;
        document.getElementById('classSubmitBtn').textContent = 'Guardar';
        new bootstrap.Modal(document.getElementById('classModal')).show();
    }

    // Abrir modal de confirmación de eliminación
    function openDeleteModal(id, topic) {
        document.getElementById('deleteClassName').textContent = topic;
        document.getElementById('deleteSessionForm').action = '/class_sessions/' + id;
        new bootstrap.Modal(document.getElementById('deleteModal')).show();
    }
</script>